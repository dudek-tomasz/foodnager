---
/**
 * Reset Password Page
 *
 * Password reset page using AuthLayout and ResetPasswordForm component.
 * Features:
 * - Server-side rendering with token validation
 * - Redirects to forgot-password if token is missing/invalid
 * - Clean, centered design without navigation
 * - Password strength validation
 * - Success state with auto-redirect to login
 *
 * Following auth-spec.md US-001.7: Password recovery
 */

import AuthLayout from "@/layouts/AuthLayout.astro";
import ResetPasswordForm from "@/components/auth/ResetPasswordForm";

export const prerender = false;

// Get token from URL (query param or hash)
// Supabase can send token in different formats depending on configuration
const tokenFromQuery = Astro.url.searchParams.get("token");
const tokenFromHash = Astro.url.hash.replace("#", "");
const token = tokenFromQuery || tokenFromHash;

// If no token, redirect to forgot-password with error
if (!token) {
  return Astro.redirect("/forgot-password?error=invalid_token");
}

// Optional: Check if user is already logged in
// If so, they don't need to reset password
const user = Astro.locals.user;
if (user) {
  return Astro.redirect("/fridge");
}
---

<AuthLayout title="Resetowanie hasÅ‚a - Foodnager" description="Ustaw nowe hasÅ‚o do konta Foodnager">
  <div class="space-y-6">
    <!-- Logo Section -->
    <div class="text-center space-y-2">
      <div class="flex justify-center">
        <span class="text-6xl">ðŸ”‘</span>
      </div>
      <h1 class="text-3xl font-bold tracking-tight text-neutral-900 dark:text-neutral-100">Nowe hasÅ‚o</h1>
      <p class="text-neutral-600 dark:text-neutral-300">Ustaw nowe, bezpieczne hasÅ‚o dla swojego konta</p>
    </div>

    <!-- Reset Password Form -->
    <ResetPasswordForm client:load token={token} />
  </div>
</AuthLayout>
